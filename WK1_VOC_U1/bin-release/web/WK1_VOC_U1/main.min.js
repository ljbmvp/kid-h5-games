var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),BoxAlign;!function(t){t[t.left_top=0]="left_top",t[t.top=1]="top",t[t.right_top=2]="right_top",t[t.right=3]="right",t[t.right_bottom=4]="right_bottom",t[t.bottom=5]="bottom",t[t.left_bottom=6]="left_bottom",t[t.left=7]="left",t[t.center=8]="center"}(BoxAlign||(BoxAlign={}));var BaseBox=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.show=function(t,e,i){switch(void 0===e&&(e=BoxAlign.center),void 0===i&&(i=new egret.Point(0,0)),t&&Game.instance.uiLayer.addChild(this.maskUI),Game.instance.uiLayer.addChild(this),e){case BoxAlign.left_top:this.x=0,this.y=0;break;case BoxAlign.top:this.x=(Game.instance.stageW-this.width)/2,this.y=0;break;case BoxAlign.right_top:this.x=Game.instance.stageW-this.width,this.y=0;break;case BoxAlign.right:this.x=Game.instance.stageW-this.width,this.y=(Game.instance.stageH-this.height)/2;break;case BoxAlign.right_bottom:this.x=Game.instance.stageW-this.width,this.y=Game.instance.stageH-this.height;break;case BoxAlign.bottom:this.x=(Game.instance.stageW-this.width)/2,this.y=Game.instance.stageH-this.height;break;case BoxAlign.left_bottom:this.x=0,this.y=Game.instance.stageH-this.height;break;case BoxAlign.left:this.x=0,this.y=(Game.instance.stageH-this.height)/2;break;case BoxAlign.center:this.x=(Game.instance.stageW-this.width)/2,this.y=(Game.instance.stageH-this.height)/2}this.x+=i.x,this.y+=i.y},e.prototype.hide=function(t){void 0===t&&(t=!1),DisplayUtil.remove(this),DisplayUtil.remove(this.m_mask),t&&this.dispose()},e.prototype.dispose=function(){this.m_mask=null},Object.defineProperty(e.prototype,"maskUI",{get:function(){return null==this.m_mask&&(this.m_mask=new egret.Sprite,this.m_mask.touchEnabled=!0),this.m_mask.graphics.clear(),this.m_mask.graphics.beginFill(0,.5),this.m_mask.graphics.drawRect(0,0,Game.instance.stageW,Game.instance.stageH),this.m_mask.graphics.endFill(),this.m_mask},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(BaseBox.prototype,"BaseBox");var StepType;!function(t){t[t.wait=0]="wait",t[t.exec=1]="exec",t[t.block=2]="block"}(StepType||(StepType={}));var Step=function(){function t(){this.m_taskList=[]}return t.prototype.wait=function(t){var e=this;return this.m_taskList.push({type:StepType.wait,data:t}),egret.setTimeout(function(){e.check()},this,0),this},t.prototype.exec=function(t,e){var i=this;return this.m_taskList.push({type:StepType.exec,data:{func:t,thisObj:e}}),egret.setTimeout(function(){i.check()},this,0),this},t.prototype.block=function(t,e){var i=this;return this.m_taskList.push({type:StepType.block,data:{func:t,thisObj:e}}),egret.setTimeout(function(){i.check()},this,0),this},t.prototype.next=function(){this.m_waitting=!1,egret.clearTimeout(this.m_timeId),this.check()},t.prototype.clear=function(){this.m_waitting=!1,egret.clearTimeout(this.m_timeId),this.m_taskList.length=0},t.prototype.check=function(){if(!this.m_waitting&&this.m_taskList.length>0){var t=this.m_taskList.shift();this.checkTask(t)}},t.prototype.checkTask=function(t){t.type==StepType.wait?this.doWait(t):t.type==StepType.exec?this.doExec(t):t.type==StepType.block&&this.doBlock(t)},t.prototype.doWait=function(t){var e=this,i=t.data;this.m_waitting=!0,this.m_timeId=egret.setTimeout(function(){e.m_waitting=!1,e.check()},this,i)},t.prototype.doExec=function(t){var e=t.data.func,i=t.data.thisObj;e.call(i),this.check()},t.prototype.doBlock=function(t){this.m_waitting=!0;var e=t.data.func,i=t.data.thisObj;e.call(i)},t}();__reflect(Step.prototype,"Step");var Workflow=function(){function t(){this.m_step=new Step,this.m_list=[]}return t.prototype.addWait=function(t){this.m_list.push({type:StepType.wait,data:t})},t.prototype.addExec=function(t,e){this.m_list.push({type:StepType.exec,data:{func:t,thisObj:e}})},t.prototype.addBlock=function(t,e){this.m_list.push({type:StepType.block,data:{func:t,thisObj:e}})},t.prototype.run=function(){this.m_step.clear();for(var t=0;t<this.m_list.length;t++){var e=this.m_list[t];e.type==StepType.wait?this.m_step.wait(e.data):e.type==StepType.exec?this.m_step.exec(e.func,e.thisObj):e.type==StepType.block&&this.m_step.block(e.func,e.thisObj)}},t.prototype.next=function(){this.m_step.next()},t}();__reflect(Workflow.prototype,"Workflow");var DisplayUtil=function(){function t(){}return t.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},t.createMovieClipByName=function(t){var e=RES.getRes(t+"_json"),i=RES.getRes(t+"_png"),n=new egret.MovieClipDataFactory(e,i);return new egret.MovieClip(n.generateMovieClipData(t))},t.remove=function(t){null!=t&&null!=t.parent&&t.parent.removeChild(t)},t}();__reflect(DisplayUtil.prototype,"DisplayUtil");var Game=function(t){function e(){var i=t.call(this)||this;return i.m_state=e.GAME_INIT,i.m_rightCount=0,i}return __extends(e,t),e.prototype.run=function(){var t=this;e.instance=this;var i=RES.getRes("config_json");this.m_qList=i.list,this.m_laveList=new Array,this.m_bgSound=new SoundPlayer,this.m_qSound=new SoundPlayer,this.m_effSound=new SoundPlayer,this.m_sceneLayer=new egret.Sprite,this.addChild(this.m_sceneLayer),this.m_uiLayer=new egret.Sprite,this.m_uiLayer.touchEnabled=this.m_uiLayer.touchChildren=!0,this.addChild(this.m_uiLayer),this.m_birdManager=new BirdManager,this.m_birdManager.init(i),this.m_birdManager.addEventListener("TOUCH_CARD",this.onTouchCard,this),this.m_gameScene=new GameScene,this.m_sceneLayer.addChild(this.m_gameScene),this.m_role1=new RoleView("role1"),this.m_role1.x=576,this.m_role1.y=735,this.m_sceneLayer.addChild(this.m_role1),this.m_scoreBoard=new ScoreBoard,this.m_scoreBoard.show(!1,BoxAlign.right_top,new egret.Point(-50,50)),this.m_clockBoard=new ClockBoard,this.m_clockBoard.show(!1,BoxAlign.left_top,new egret.Point(50,50)),this.m_clockBoard.text=""+e.GAME_TIME,this.m_musicBtn=new MusicBtn,this.m_musicBtn.show(!1,BoxAlign.right_bottom,new egret.Point(-50,-50)),this.m_musicBtn.addEventListener(egret.Event.CHANGE,this.updateBgMusic,this),this.m_repeatBtn=DisplayUtil.createBitmapByName("repatBtn_png"),this.m_repeatBtn.touchEnabled=!0,this.m_repeatBtn.x=this.m_musicBtn.x,this.m_repeatBtn.y=this.m_musicBtn.y-120,this.uiLayer.addChild(this.m_repeatBtn),this.m_repeatBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){null!=t.m_curQuestion&&(t.m_qSound.clear(),t.m_qSound.playRes(t.m_curQuestion.audio))},this),this.m_playAgainBtn=DisplayUtil.createBitmapByName("playAgainBtn_png"),this.m_playAgainBtn.touchEnabled=!0,this.m_playAgainBtn.x=this.m_repeatBtn.x,this.m_playAgainBtn.y=this.m_repeatBtn.y,this.m_playAgainBtn.visible=!1,this.uiLayer.addChild(this.m_playAgainBtn),this.m_playAgainBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.gamePlay()},this),this.m_tryAgainBtn=DisplayUtil.createBitmapByName("tryAgainBtn_png"),this.m_tryAgainBtn.touchEnabled=!0,this.m_tryAgainBtn.x=this.m_repeatBtn.x,this.m_tryAgainBtn.y=this.m_repeatBtn.y,this.m_tryAgainBtn.visible=!1,this.uiLayer.addChild(this.m_tryAgainBtn),this.m_tryAgainBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.gamePlay()},this),this.addEventListener(egret.Event.ENTER_FRAME,this.onRender,this),this.m_state=e.GAME_INIT,this.m_gameStartBox=new GameStartBox,this.m_gameStartBox.once("START",this.gamePlay,this),this.m_gameStartBox.show(!0)},e.prototype.onRender=function(){this.m_state==e.GAME_PLAY&&(this.m_gameScene.onRender(),this.m_birdManager.onRender())},e.prototype.gamePlay=function(){this.m_state=e.GAME_PLAY,this.m_gameStartBox.hide(),this.m_role1.state=RoleState.idle,this.m_wind&&this.m_wind.hide(),this.updateBgMusic(),this.m_rightCount=0,this.m_scoreBoard.setScore(0),this.startTimer(),this.m_laveList=this.m_qList.concat(),ArrayUtil.randomSort(this.m_laveList),this.question(),this.m_birdManager.reset(),this.m_birdManager.start()},e.prototype.question=function(){this.m_answering=!1,this.m_repeatBtn.visible=!0,this.m_playAgainBtn.visible=!1,this.m_tryAgainBtn.visible=!1,0==this.m_laveList.length&&(this.m_laveList=this.m_qList.concat(),ArrayUtil.randomSort(this.m_laveList)),this.m_curQuestion=this.m_laveList.shift(),this.m_qSound.playRes(this.m_curQuestion.audio)},e.prototype.onTouchCard=function(t){if(!this.m_answering){this.m_answering=!0,this.m_repeatBtn.visible=!1,this.m_qSound.clear();var e=t.data;this.m_curCardView=e.cardView,e.cardName==this.m_curQuestion.name?this.answerRight():this.answerWrong()}},e.prototype.answerRight=function(){var t=this;this.m_rightCount+=1,this.m_scoreBoard.setScore(this.m_rightCount),this.m_role1.state=RoleState.happy,this.m_curCardView.right(),this.m_effSound.clear(),this.m_effSound.playRes("U1VOC03_mp3"),this.m_effSound.exec(function(){t.m_rightCount>=e.WIN_NUM?(t.stopTimer(),t.m_state=e.GAME_OVER,t.m_birdManager.hideCard(),t.m_role1.state=RoleState.celebrate_hand,t.m_effSound.playRes("U1VOC05_mp3"),t.m_effSound.exec(function(){t.m_role1.state=RoleState.celebrate_mouth},t),t.m_effSound.playRes("U1VOC-OS01_mp3").playRes("U1VOC-OS02_mp3"),t.m_effSound.exec(function(){t.m_role1.state=RoleState.celebrate,t.m_playAgainBtn.visible=!0,t.submit(!0)},t)):(t.question(),t.m_role1.state=RoleState.idle)},this)},e.prototype.answerWrong=function(){var t=this;this.m_role1.state=RoleState.sad,this.m_curCardView.wrong(),this.m_effSound.clear(),this.m_effSound.playRes("U1VOC04_mp3"),this.m_effSound.exec(function(){t.m_role1.state=RoleState.idle,t.m_qSound.playRes(t.m_curQuestion.audio).exec(function(){t.m_repeatBtn.visible=!0},self),t.m_answering=!1},this)},e.prototype.updateBgMusic=function(){0==this.m_musicBtn.state?(Println("停止背景音乐"),this.m_bgSound.clear()):(Println("播放背景音乐"),this.m_bgSound.playRes("bgmusic_mp3",0))},e.prototype.stopTimer=function(){this.m_timer&&(this.m_timer.stop(),this.m_timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.m_timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this)),this.m_timer=null},e.prototype.startTimer=function(){this.stopTimer(),this.m_timer=new egret.Timer(1e3,e.GAME_TIME),this.m_timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.m_timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this),this.m_timer.start(),this.onTimer(null)},e.prototype.onTimer=function(t){this.m_clockBoard.text=""+(this.m_timer.repeatCount-this.m_timer.currentCount)},e.prototype.onTimerComplete=function(t){var i=this;this.stopTimer(),this.m_state=e.GAME_OVER,this.m_effSound.clear(),this.m_qSound.clear(),this.m_birdManager.wrong(),null==this.m_wind&&(this.m_wind=new WindView),this.m_wind.show(this.sceneLayer),this.m_role1.state=RoleState.sad,this.m_effSound.clear(),this.m_effSound.playRes("U1VOC06_mp3").playRes("U1VOC07_mp3"),this.m_effSound.exec(function(){i.m_role1.state=RoleState.sad_mouth},this),this.m_effSound.playRes("U1VOC-OS03_mp3"),this.m_effSound.exec(function(){i.m_role1.state=RoleState.sad},this),this.submit(!1),this.m_tryAgainBtn.visible=!0},e.prototype.submit=function(t){var e=GetRequestObject();GameOver(t,function(){0==e.taskId&&(t?SetSuccessPanelVisible(!0):SetFailPanelVisible(!0))})},Object.defineProperty(e.prototype,"uiLayer",{get:function(){return this.m_uiLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sceneLayer",{get:function(){return this.m_sceneLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageW",{get:function(){return this.stage.stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageH",{get:function(){return this.stage.stageHeight},enumerable:!0,configurable:!0}),e.WIN_NUM=6,e.GAME_TIME=60,e.GAME_INIT="game_init",e.GAME_PLAY="game_play",e.GAME_OVER="game_over",e}(egret.Sprite);__reflect(Game.prototype,"Game");var ClockBoard=function(t){function e(){var e=t.call(this)||this,i=DisplayUtil.createBitmapByName("clock_png");return e.addChild(i),e.m_tf=new egret.TextField,e.m_tf.textColor=16711680,e.m_tf.size=56,e.m_tf.bold=!0,e.m_tf.textAlign=egret.HorizontalAlign.CENTER,e.m_tf.width=104,e.m_tf.height=66,e.m_tf.x=26,e.m_tf.y=80,e.addChild(e.m_tf),e}return __extends(e,t),Object.defineProperty(e.prototype,"text",{get:function(){return this.m_tf.text},set:function(t){this.m_tf.text=t},enumerable:!0,configurable:!0}),e}(BaseBox);__reflect(ClockBoard.prototype,"ClockBoard");var GameStartBox=function(t){function e(){var e=t.call(this)||this;return e.m_startBtn=DisplayUtil.createBitmapByName("start_png"),e.m_startBtn.$touchEnabled=!0,e.addChild(e.m_startBtn),e.m_startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.start,e),e}return __extends(e,t),e.prototype.start=function(){this.hide(),this.dispatchEvent(new egret.Event("START"))},e.prototype.dispose=function(){this.m_startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.start,this),this.m_startBtn=null,t.prototype.dispose.call(this)},e}(BaseBox);__reflect(GameStartBox.prototype,"GameStartBox");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var MusicBtn=function(t){function e(){var e=t.call(this)||this;return e.m_state=1,e.btn=DisplayUtil.createBitmapByName("musicBtn_png"),e.addChild(e.btn),e.btn.touchEnabled=!0,e.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(e,t),e.prototype.onTouchTap=function(){this.m_state=(this.m_state+1)%2,this.btn.texture=0==this.m_state?RES.getRes("muteBtn_png"):RES.getRes("musicBtn_png"),this.dispatchEvent(new egret.Event(egret.Event.CHANGE))},Object.defineProperty(e.prototype,"state",{get:function(){return this.m_state},enumerable:!0,configurable:!0}),e}(BaseBox);__reflect(MusicBtn.prototype,"MusicBtn");var ScoreBoard=function(t){function e(){var e=t.call(this)||this;e.scoreMax=6,e.touchCount=0;for(var i=0;i<e.scoreMax;i++){var n=DisplayUtil.createBitmapByName("starDark_png");n.name="star"+(e.scoreMax-i-1),n.y=0,n.x=i*(n.width+5),e.addChild(n),0==i&&(n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.touchCount++,e.touchCount%20==0?SetLogPanelVisible(!1):e.touchCount%10==0&&SetLogPanelVisible(!0)},e))}return e}return __extends(e,t),e.prototype.setScore=function(t){for(var e=0;e<this.scoreMax;e++){var i=this.getChildByName("star"+e),n=void 0;n=t>=e+1?RES.getRes("starLight_png"):RES.getRes("starDark_png"),i.texture=n}},e}(BaseBox);__reflect(ScoreBoard.prototype,"ScoreBoard");var ArrayUtil=function(){function t(){}return t.randomSort=function(t){var e=t.concat();for(t.length=0;e.length>0;){var i=MathUtil.random(0,e.length-1),n=e.splice(i,1)[0];t.push(n)}},t}();__reflect(ArrayUtil.prototype,"ArrayUtil");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.loadingView.x=(this.stage.stageWidth-this.loadingView.width)/2,this.loadingView.y=(this.stage.stageHeight-this.loadingView.height)/2,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){this.game=new Game,this.game.touchEnabled=!0,this.addChild(this.game),this.game.run()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var MathUtil=function(){function t(){}return t.R2D=function(t){return 180*t/Math.PI},t.D2R=function(t){return t*Math.PI/180},t.random=function(e,i,n){if(void 0===i&&(i=0),void 0===n&&(n=1),e>i){var o=e;e=i,i=o}var r=i-e+1*n,a=Math.random()*r;return a+=e,t.floor(a,n)},t.floor=function(t,e){return void 0===e&&(e=1),Math.floor(t/e)*e},t}();__reflect(MathUtil.prototype,"MathUtil");var SoundPlayer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.exec=function(t,e){var i=this;return this.m_taskList.push({type:StepType.exec,data:{func:t,thisObj:e}}),egret.setTimeout(function(){i.check()},this,0),this},e.prototype.playRes=function(t,e,i){var n=this;void 0===e&&(e=1),void 0===i&&(i=1),Println("playRes key:"+t+" loop:"+e+" volume:"+i);var o={type:"playRes",data:{key:t,loop:e,volume:i}};return this.m_waitting?(this.m_taskList.push(o),egret.setTimeout(function(){n.check()},this,0)):this.doPlayRes(o),this},e.prototype.checkTask=function(e){t.prototype.checkTask.call(this,e),"playRes"==e.type&&this.doPlayRes(e)},e.prototype.doPlayRes=function(t){this.m_waitting=!0;var e=t.data.key;this._loop=t.data.loop,this._volume=t.data.volume,this.stopSound(),this._sound=RES.getRes(e),this._channel=this._sound.play(0,this._loop),this._channel.volume=this._volume,this._channel.addEventListener(egret.Event.SOUND_COMPLETE,this.onPlayComplete,this),Println("doPlayRes key:"+e+" sound:"+this._sound)},e.prototype.stopSound=function(){this._channel&&(this._channel.removeEventListener(egret.Event.SOUND_COMPLETE,this.onPlayComplete,this),this._channel.stop(),this._channel=null)},e.prototype.onPlayComplete=function(t){this.stopSound(),this.m_waitting=!1,this.check()},e.prototype.clear=function(){t.prototype.clear.call(this),this.stopSound()},e}(Step);__reflect(SoundPlayer.prototype,"SoundPlayer");var BirdManager=function(t){function e(){var e=t.call(this)||this;return e.m_speedY=2.5,e.m_speedX=-8,e.m_intervalTime=3500,e.m_lastTime=0,e}return __extends(e,t),e.prototype.init=function(t){this.m_json=t,this.m_birdArr=Array(),this.m_lastTime=0,this.m_touchSound=new SoundPlayer},e.prototype.onRender=function(){egret.getTimer()-this.m_lastTime>this.m_intervalTime&&this.addBird(),this.moveBrid(),this.moveCard()},e.prototype.addBird=function(){this.m_lastTime=egret.getTimer();for(var t=this.m_json.list.concat(),e=t.length-1;e>=0;e--)for(var i=t[e],n=0;n<this.m_birdArr.length;n++)if(i.name==this.m_birdArr[n].cardName){t.splice(e,1);break}if(0==t.length)return void Println("当前没有可以添加的卡牌");var o=MathUtil.random(0,t.length-1),r=t[o],a=new BirdView;a.addCard(r),a.x=Game.instance.stageW+100,a.y=100+this.m_count%2*150,a.fly(),a.addEventListener("TOUCH_CARD",this.onTouchCard,this),Game.instance.sceneLayer.addChild(a),this.m_birdArr.push(a),this.m_count++},e.prototype.start=function(){this.reset(),this.addBird()},e.prototype.moveBrid=function(){for(var t=this.m_birdArr.length-1;t>=0;t--){var e=this.m_birdArr[t];e.x+=this.m_speedX,e.x<=-400&&(this.m_birdArr.splice(t,1),e.dispose())}},e.prototype.moveCard=function(){for(var t=this.m_birdArr.length-1;t>=0;t--){var e=this.m_birdArr[t];e.x<Game.instance.stageW-200&&(e.cardView.y+=this.m_speedY)}},e.prototype.onTouchCard=function(t){this.m_touchSound.playRes("U1VOC02_mp3");var e=new egret.Event("TOUCH_CARD");e.data=t.currentTarget,this.dispatchEvent(e)},e.prototype.reset=function(){for(var t=this.m_birdArr.length-1;t>=0;t--){var e=this.m_birdArr[t];DisplayUtil.remove(e),e.dispose()}this.m_birdArr.length=0,this.m_count=0},e.prototype.wrong=function(){for(var t=this.m_birdArr.length-1;t>=0;t--){var e=this.m_birdArr[t];e.fail(),e.cardView.visible=!1}},e.prototype.hideCard=function(){for(var t=0;t<this.m_birdArr.length;t++){var e=this.m_birdArr[t];e.cardView.visible=!1}},e}(egret.EventDispatcher);__reflect(BirdManager.prototype,"BirdManager");var BirdView=function(t){function e(){var e=t.call(this)||this;return e.m_bird=DisplayUtil.createMovieClipByName("bird"),e.addChild(e.m_bird),e}return __extends(e,t),e.prototype.fly=function(){this.m_bird.gotoAndPlay("fly",-1)},e.prototype.fail=function(){var t=MathUtil.random(1,3,1);this.m_bird.gotoAndStop("fail"+t)},e.prototype.addCard=function(t){var e=new CardView(t.image,t.audio,t.name);e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchCard,this),this.m_card=e,this.addChild(this.m_card)},e.prototype.onTouchCard=function(t){var e=new egret.Event("TOUCH_CARD");this.dispatchEvent(e)},e.prototype.dispose=function(){DisplayUtil.remove(this.m_bird),this.m_bird=null,this.m_card.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchCard,this),DisplayUtil.remove(this.m_card),this.m_card=null},Object.defineProperty(e.prototype,"cardName",{get:function(){return this.m_card.cardName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cardView",{get:function(){return this.m_card},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(BirdView.prototype,"BirdView");var CardView=function(t){function e(e,i,n){var o=t.call(this)||this;return o.image=e,o.audio=i,o.cardName=n,o.m_mc=DisplayUtil.createMovieClipByName("card"),o.addChild(o.m_mc),o.m_mc.gotoAndStop("none"),o.m_content=DisplayUtil.createBitmapByName(o.image),o.m_content.x=-108.5,o.m_content.y=89,o.m_content.width=o.m_content.height=180,o.addChild(o.m_content),o}return __extends(e,t),e.prototype.reset=function(){this.m_mc.gotoAndStop("none")},e.prototype.wrong=function(){this.m_mc.gotoAndPlay("wrong",1),egret.Tween.get(this).wait(1e3).to({alpha:0,scaleX:0,scaleY:0},300);var t=[.212671,.71516,.072169,0,0,.212671,.71516,.072169,0,0,.212671,.71516,.072169,0,0,0,0,0,1,0];this.filters=[new egret.ColorMatrixFilter(t)]},e.prototype.right=function(){this.m_mc.gotoAndPlay("right",1),egret.Tween.get(this).wait(1e3).to({alpha:0,scaleX:0,scaleY:0},300)},e}(egret.Sprite);__reflect(CardView.prototype,"CardView");var GameScene=function(t){function e(){var e=t.call(this)||this;return e.m_bg=DisplayUtil.createBitmapByName("scene_jpg"),e.addChild(e.m_bg),e.m_cloud1=DisplayUtil.createBitmapByName("cloud1_png"),e.m_cloud1.x=115,e.m_cloud1.y=104,e.addChild(e.m_cloud1),e.m_cloud2=DisplayUtil.createBitmapByName("cloud2_png"),e.m_cloud2.x=500,e.m_cloud2.y=77,e.addChild(e.m_cloud2),e.m_cloud3=DisplayUtil.createBitmapByName("cloud3_png"),e.m_cloud3.x=1360,e.m_cloud3.y=110,e.addChild(e.m_cloud3),e}return __extends(e,t),e.prototype.onRender=function(){this.moveCloud(this.m_cloud1,1),this.moveCloud(this.m_cloud2,2),this.moveCloud(this.m_cloud3,2.2)},e.prototype.moveCloud=function(t,e){t.x+=e,t.x>Game.instance.stageW&&(t.x=-t.width)},e}(egret.Sprite);__reflect(GameScene.prototype,"GameScene");var PaoPaoView=function(t){function e(){var e=t.call(this)||this;return Math.random()>.5?e.texture=RES.getRes("paopao1_png"):e.texture=RES.getRes("paopao2_png"),e}return __extends(e,t),e}(egret.Bitmap);__reflect(PaoPaoView.prototype,"PaoPaoView");var RoleState;!function(t){t[t.idle=0]="idle",t[t.happy=1]="happy",t[t.sad=2]="sad",t[t.sad_mouth=3]="sad_mouth",t[t.celebrate_hand=4]="celebrate_hand",t[t.celebrate_mouth=5]="celebrate_mouth",t[t.celebrate=6]="celebrate"}(RoleState||(RoleState={}));var RoleView=function(t){function e(e){var i=t.call(this)||this;i.m_roleName=e;var n=RES.getRes(e+"_json"),o=RES.getRes(e+"_png"),r=new egret.MovieClipDataFactory(n,o);return i.m_role=new egret.MovieClip(r.generateMovieClipData(e)),i.m_role.stop(),i.addChild(i.m_role),i}return __extends(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this.m_state},set:function(t){this.m_isChangeState=this.m_state!=t,this.m_state=t,this.m_isChangeState&&(this.m_isChangeState=!1,this[RoleState[this.m_state]]())},enumerable:!0,configurable:!0}),e.prototype.onPlay=function(){this.m_role.play()},e.prototype.onPause=function(){this.m_role.stop()},e.prototype.onRender=function(){},e.prototype.idle=function(){this.m_role.gotoAndPlay(RoleState[RoleState.idle],-1)},e.prototype.happy=function(){this.m_role.gotoAndStop(RoleState[RoleState.happy])},e.prototype.sad=function(){this.m_role.gotoAndPlay(RoleState[RoleState.sad],-1)},e.prototype.sad_mouth=function(){this.m_role.gotoAndPlay(RoleState[RoleState.sad_mouth],-1)},e.prototype.celebrate_hand=function(){this.m_role.gotoAndPlay(RoleState[RoleState.celebrate_hand],-1)},e.prototype.celebrate_mouth=function(){this.m_role.gotoAndPlay(RoleState[RoleState.celebrate_mouth],-1)},e.prototype.celebrate=function(){this.m_role.gotoAndStop(RoleState[RoleState.celebrate])},e}(egret.Sprite);__reflect(RoleView.prototype,"RoleView");var WindView=function(t){function e(){var e=t.call(this)||this;return e.m_view=DisplayUtil.createBitmapByName("wind_png"),e.addChild(e.m_view),e}return __extends(e,t),e.prototype.show=function(t){t.addChild(this),this.playTween()},e.prototype.playTween=function(){var t=this;this.m_view.alpha=0,this.m_view.x=398,this.m_view.y=120,egret.Tween.get(this.m_view).to({x:288.15,y:244.05,alpha:1},600).wait(300).to({x:206.2,y:356,alpha:0},400).call(function(){t.playTween()},this)},e.prototype.hide=function(){egret.Tween.removeTweens(this.m_view),DisplayUtil.remove(this)},e}(egret.Sprite);__reflect(WindView.prototype,"WindView");